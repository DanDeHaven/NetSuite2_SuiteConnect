create or replace view FINANCE.ADMIN_CORE_CURATED.CTS_NS_TRANSACTION_LINE(
	NS_TRANSACTION_ID,
	NS_TRANSACTION_LINE_ID,
	NS_UNIQUE_KEY,
	NS_CREATED_FROM_TRANSACTION_ID,
	NS_CREATED_BY_EMPLOYEE_ID,
	NS_ACCOUNT_ID,
	GPS_NS_ACCOUNT_ID,
	NS_ENTITY_ID,
	NS_DEPARTMENT_ID,
	NS_ITEM_ID,
	NS_CLASS_ID,
	NS_LOCATION_ID,
	NS_SUBSIDIARY_ID,
	PERIOD_END_DATE,
	LINE_ORDER,
	TRANSACTION_TYPE,
	RECORD_TYPE,
	ACCOUNT_TYPE,
	DEPARTMENT,
	CLASS,
	LOCATION,
	ITEM,
	ITEMTYPE,
	SUBSCRIPTION_RATE,
	PLAN_ADD_1_PRICE,
	PLAN_ADD_2_PRICE,
	SALES_CHANNEL,
	PRODUCT_CATEGORY,
	PAYMENT_METHOD,
	MAINLINE,
	IS_MAINLINE,
	DO_NOT_DISPLAY,
	MEMO,
	QUANTITY,
	RATE_AMOUNT,
	RATE_PERCENT,
	DEBIT_AMOUNT,
	CREDIT_AMOUNT,
	AMOUNT,
	FX_LINKED_AMOUNT,
	NET_AMOUNT
) as
--
-- D3 5.19.24 ADDED GPS_NS_ACCOUNT_ID
--
SELECT
    SD.TRANSACTION AS NS_TRANSACTION_ID,
    SD.ID AS NS_TRANSACTION_LINE_ID,
    SD.UNIQUEKEY AS NS_UNIQUE_KEY,
    SD.CREATEDFROM AS NS_CREATED_FROM_TRANSACTION_ID,
    TR.CREATEDBY AS NS_CREATED_BY_EMPLOYEE_ID,
    SD.EXPENSEACCOUNT AS NS_ACCOUNT_ID,
    ACCT.CUSTRECORD_GPS_NS_ACCOUNT_ID AS GPS_NS_ACCOUNT_ID,
    SD.ENTITY AS NS_ENTITY_ID,
    SD.DEPARTMENT AS NS_DEPARTMENT_ID,
    SD.ITEM AS NS_ITEM_ID,
    SD.CLASS AS NS_CLASS_ID,
    SD.LOCATION AS NS_LOCATION_ID,
    SD.SUBSIDIARY AS NS_SUBSIDIARY_ID,
    AP.ENDDATE::DATE AS PERIOD_END_DATE,
    
    SD.LINESEQUENCENUMBER AS LINE_ORDER,
    TR.TYPE AS TRANSACTION_TYPE,
    TR.RECORDTYPE AS RECORD_TYPE,
    ACCT.ACCTTYPE AS ACCOUNT_TYPE,
    DP.NAME AS DEPARTMENT,
    CL.NAME AS CLASS,
    LO.NAME AS LOCATION,
    ITM.FULLNAME AS ITEM,
    SD.ITEMTYPE,
    SD.CUSTCOLSUBSCRIPTIONRATE AS SUBSCRIPTION_RATE,
    SD.CUSTCOLPLANADDON1PRICE AS PLAN_ADD_1_PRICE,
    SD.CUSTCOLPLANADDON2PRICE AS PLAN_ADD_2_PRICE,

    SEGSC.NAME AS SALES_CHANNEL,
    SEGPC.NAME AS PRODUCT_CATEGORY,
    PM.NAME AS PAYMENT_METHOD,
    SD.MAINLINE,
    CASE SD.MAINLINE WHEN 'T' THEN 'Yes' ELSE 'No' END AS IS_MAINLINE,
    CASE SD.DONOTDISPLAYLINE WHEN 'T' THEN 'Yes' ELSE 'No' END AS DO_NOT_DISPLAY,
    
    SD.MEMO,
    SD.QUANTITY * -1 AS QUANTITY,
    SD.RATEAMOUNT AS RATE_AMOUNT,
    SD.RATEPERCENT AS RATE_PERCENT,
    
    SD.DEBITFOREIGNAMOUNT AS DEBIT_AMOUNT,
    SD.CREDITFOREIGNAMOUNT AS CREDIT_AMOUNT,
    CASE 
        WHEN ACTY.LEFT = 'F' AND ACTY.BALANCESHEET = 'F' THEN SD.FOREIGNAMOUNT * -1
        ELSE SD.FOREIGNAMOUNT
    END AS AMOUNT,
    SD.FXAMOUNTLINKED AS FX_LINKED_AMOUNT,
    CASE 
        WHEN ACTY.LEFT = 'F' AND ACTY.BALANCESHEET = 'F' THEN SD.NETAMOUNT * -1
        ELSE SD.NETAMOUNT
    END AS NET_AMOUNT
    

FROM
    FINANCE.CTS_NETSUITE2.TRANSACTIONLINE SD
        INNER JOIN 
    FINANCE.CTS_NETSUITE2.TRANSACTION TR
            ON SD.TRANSACTION = TR.ID
        LEFT OUTER JOIN
    FINANCE.CTS_NETSUITE2.ACCOUNT ACCT
            ON SD.EXPENSEACCOUNT = ACCT.ID
        LEFT OUTER JOIN
    FINANCE.CTS_NETSUITE2.ACCOUNTTYPE ACTY
            ON ACCT.ACCTTYPE = ACTY.ID
        LEFT OUTER JOIN
    FINANCE.CTS_NETSUITE2.ACCOUNTINGPERIOD AP
            ON TR.POSTINGPERIOD = AP.ID
        LEFT OUTER JOIN
    FINANCE.CTS_NETSUITE2.DEPARTMENT DP
            ON SD.DEPARTMENT = DP.ID
        LEFT OUTER JOIN
    FINANCE.CTS_NETSUITE2.CLASSIFICATION CL
            ON SD.CLASS = CL.ID 
        LEFT OUTER JOIN
    FINANCE.CTS_NETSUITE2.LOCATION LO
            ON SD.LOCATION = LO.ID
        LEFT OUTER JOIN
    FINANCE.CTS_NETSUITE2.CUSTOMRECORD_CSEG_SALESCHANNEL SEGSC
            ON SD.CSEG_SALESCHANNEL = SEGSC.ID
        LEFT OUTER JOIN
    FINANCE.CTS_NETSUITE2.CUSTOMRECORD_CSEG_PRODUCTCATEGOR SEGPC
            ON SD.CSEG_PRODUCTCATEGOR = SEGPC.ID
        LEFT OUTER JOIN
    FINANCE.CTS_NETSUITE2.PAYMENTMETHOD PM
            ON SD.PAYMENTMETHOD = PM.ID
        LEFT OUTER JOIN
    FINANCE.CTS_NETSUITE2.ITEM ITM
            ON SD.ITEM = ITM.ID
        


WHERE
    SD._FIVETRAN_DELETED = 'FALSE';
