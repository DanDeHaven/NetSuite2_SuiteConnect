create or replace view FINANCE.ADMIN_CORE_CURATED.CTS_NS_CUSTOMER(
	NS_CUSTOMER_ID,
	NS_ENTITY_ID,
	CUSTOMER_NAME,
	CTS_HUBSPOT_ID,
	MACOLA_ID,
	GPS_NS_CUSTOMER_ID,
	NS_PARENT_ID,
	NS_PARTNER_ID,
	CUSTOMER_STAGE,
	CUSTOMER_STATUS,
	CATEGORY,
	ALTNAME,
	COMPANY_NAME,
	SALES_REP,
	NS_PARTNER_ENTITY_NUMBER,
	PARTNER_COMPANY_NAME,
	CUSTOMER_CATEGORY,
	PRIMARY_CURRENCY,
	PARENT_COMPANY_NAME,
	INDUSTRY,
	TERMS,
	CTS_PLATFORM,
	SUBSIDIARY,
	SALES_CHANNEL,
	BILLING_COUNTRY,
	DATE_CREATED,
	DATE_LAST_MODIFIED,
	FIRST_ORDER_DATE,
	IS_INDIVIDUAL,
	IS_INACTIVE,
	OPEN_BALANCE,
	OVERDUE_BALANCE
) as
--
-- Update 5.9.24 by D3 to included GPS_NS_CUSTOMER_ID
--
SELECT
    SD.ID AS NS_CUSTOMER_ID,
    SD.ENTITYID AS NS_ENTITY_ID,
    SD.companyname::VARCHAR AS CUSTOMER_NAME,
    SD.CUSTENTITY_CTS_HUBSPOTID AS CTS_HUBSPOT_ID,
    SD.CUSTENTITY_CTS_MACOLAID AS MACOLA_ID,
    SD.CUSTENTITY_GPSI_NS_ID AS GPS_NS_CUSTOMER_ID,
    SD.PARENT AS NS_PARENT_ID,
    SD.PARTNER AS NS_PARTNER_ID,
    SD.SEARCHSTAGE AS CUSTOMER_STAGE,
    ENST.ENTITYTYPE|| '-' || ENST.NAME AS CUSTOMER_STATUS,
    CAT.NAME AS "CATEGORY",
    SD.ALTNAME,
    IFNULL(SD.COMPANYNAME, SD.ALTNAME) AS COMPANY_NAME,
    EM.FIRSTNAME || ' ' || EM.LASTNAME AS SALES_REP,
     
    PART.ENTITYNUMBER AS NS_PARTNER_ENTITY_NUMBER,
    PART.COMPANYNAME AS PARTNER_COMPANY_NAME,
    CASE 
        WHEN SPLIT_PART(SD.CUSTENTITY_CTS_CUSTCATEGORY, ',', 1) = '11' THEN 'FieldDocs ELD 2.0' 
        else CC.NAME
    END AS CUSTOMER_CATEGORY,
    CASE WHEN SD.CURRENCY = 1 THEN 'CAD' ELSE 'USD' END AS PRIMARY_CURRENCY,
    
    PC.COMPANYNAME AS PARENT_COMPANY_NAME,
    IND.NAME AS INDUSTRY,
    TER.NAME AS TERMS,
    PV.NAME AS CTS_PLATFORM,
    CASE SD.CSEG_SUBSIDIARYAMM
        WHEN 1 THEN 'CTS_CA'
        WHEN 2 THEN 'CTS_US'
        else '' 
    END AS SUBSIDIARY,
    SC.NAME AS SALES_CHANNEL,
    BA.COUNTRY AS BILLING_COUNTRY,
    
    SD.DATECREATED::DATE AS DATE_CREATED,
    SD.LASTMODIFIEDDATE AS DATE_LAST_MODIFIED,
    SD.FIRSTORDERDATE::DATE AS FIRST_ORDER_DATE,
    CASE SD.ISPERSON WHEN 'F' Then 'No' ELSE 'Yes' END AS IS_INDIVIDUAL,
    CASE WHEN SD.ISINACTIVE = 'T' THEN 'Yes' ELSE 'No' END AS IS_INACTIVE,
    SD.BALANCESEARCH AS OPEN_BALANCE,
    SD.OVERDUEBALANCESEARCH AS OVERDUE_BALANCE
    
FROM
    FINANCE.CTS_NETSUITE2.CUSTOMER SD
         LEFT OUTER JOIN
    FINANCE.CTS_NETSUITE2.CUSTOMER PC
            ON SD.PARENT = PC.ID
        LEFT OUTER JOIN
    FINANCE.CTS_NETSUITE2.EMPLOYEE EM
            ON SD.SALESREP = EM.ID
        LEFT OUTER JOIN
    FINANCE.CTS_NETSUITE2.TERM TER
            ON SD.TERMS = TER.ID
        LEFT OUTER JOIN 
    FINANCE.CTS_NETSUITE2.CUSTOMRECORD_ESC_INDUSTRIES IND 
            ON SD.CUSTENTITY_ESC_INDUSTRY = IND.ID 
        LEFT OUTER JOIN 
    FINANCE.CTS_NETSUITE2.PARTNER PART 
            ON SD.PARTNER = PART.ID 
        LEFT OUTER JOIN 
    FINANCE.CTS_NETSUITE2.CUSTOMERCATEGORY CC 
            ON CASE WHEN SD.CUSTENTITY_CTS_CUSTCATEGORY LIKE '%,%' THEN SPLIT_PART(SD.CUSTENTITY_CTS_CUSTCATEGORY, ',', 1)
                ELSE SD.CUSTENTITY_CTS_CUSTCATEGORY END = CC.ID 
        LEFT OUTER JOIN 
    FINANCE.CTS_NETSUITE2.ENTITYSTATUS ENST 
            ON SD.ENTITYSTATUS = ENST.KEY 
        LEFT OUTER JOIN 
    FINANCE.CTS_NETSUITE2.INVOICEBILLINGADDRESS BA 
            ON SD.DEFAULTBILLINGADDRESS = BA.NKEY 
        LEFT OUTER JOIN
    FINANCE.CTS_NETSUITE2.CUSTOMRECORD_CSEG_SALESCHANNEL SC
            ON SD.CSEG_SALESCHANNEL = SC.ID
        LEFT OUTER JOIN
    FINANCE.CTS_NETSUITE2.CUSTOMLIST_CTS_PLATFORMVAL PV
            ON SD.CUSTENTITY_CTS_PLATFORM = PV.ID
        LEFT OUTER JOIN
    FINANCE.CTS_NETSUITE2.CUSTOMERCATEGORY CAT
            ON SD.CATEGORY = CAT.ID

WHERE
    SD._FIVETRAN_DELETED = 'FALSE'
    AND SD.ENTITYID <> 'Anonymous Customer  2019110835';
